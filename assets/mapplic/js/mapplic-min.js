!function($){"use strict";var t=function(t){function i(){this.el=null,this.pin=null,this.shift=6,this.drop=0,this.location=null,this.init=function(){var t=this;this.el=$("<div></div>").addClass("mapplic-tooltip"),this.close=$("<a></a>").addClass("mapplic-tooltip-close").attr("href","#").appendTo(this.el),this.close.on("click touchend",function(t){t.preventDefault(),r.hideLocation(),r.o.zoom||r.moveTo(.5,.5,1,600,"easeInOutCubic")}),r.o.tooltip.thumb&&(this.thumbnail=$("<img>").addClass("mapplic-tooltip-thumbnail").hide().appendTo(this.el)),this.content=$("<div></div>").addClass("mapplic-tooltip-content").appendTo(this.el),this.title=$("<h4></h4>").addClass("mapplic-tooltip-title").appendTo(this.content),r.o.tooltip.desc&&(this.desc=$("<div></div>").addClass("mapplic-tooltip-description").appendTo(this.content)),r.o.tooltip.link&&(this.link=$("<a>More</a>").addClass("mapplic-popup-link").attr("href","#").hide().appendTo(this.el)),this.triangle=$("<div></div>").addClass("mapplic-tooltip-triangle").prependTo(this.el),r.map.append(this.el)},this.show=function(t){if(t){var i=this;this.location=t,r.hovertip&&r.hovertip.hide(),r.o.tooltip.thumb&&(t.thumbnail?this.thumbnail.attr("src",t.thumbnail).show():this.thumbnail.hide()),r.o.tooltip.link&&(t.link?this.link.attr("href",t.link).show():this.link.hide()),this.title.text(t.title),r.o.tooltip.desc&&this.desc.html(t.description),this.content[0].scrollTop=0,this.pin=$('.mapplic-pin[data-location="'+t.id+'"]'),0==this.pin.length?this.shift=20:this.shift=Math.abs(parseFloat(this.pin.css("margin-top")))+20,$("img",this.el).load(function(){i.position(),i.zoom(t)}),this.position(),this.el.stop().show(),this.zoom(t)}},this.position=function(){if(this.location){var t=r.map.offset().left+r.map.width()*this.location.x-r.container.offset().left,i=r.map.offset().top+r.map.height()*this.location.y-r.container.offset().top,e=100*this.location.x,a=100*this.location.y,o=-this.el.outerHeight()-this.shift,n=-this.el.outerWidth()/2;if(r.o.smartip){var l=.5;Math.abs(o)>i?(o=10,this.pin&&this.pin.length&&(o=this.pin.height()+parseFloat(this.pin.css("margin-top"))+20),this.el.addClass("mapplic-bottom")):this.el.removeClass("mapplic-bottom"),this.el.outerWidth()/2>t?l=.5-(this.el.outerWidth()/2-t)/this.el.outerWidth():r.container.width()-t-this.el.outerWidth()/2<0&&(l=.5+(t+this.el.outerWidth()/2-r.container.width())/this.el.outerWidth()),l=Math.max(0,Math.min(1,l)),n=-this.el.outerWidth()*l,this.triangle.css("left",Math.max(5,Math.min(95,100*l))+"%")}this.el.css({left:e+"%",top:a+"%",marginTop:o,marginLeft:n}),this.drop=this.el.outerHeight()+this.shift}},this.zoom=function(t){var i=.5,e="undefined"!=typeof t.zoom?t.zoom:4;i=((r.container.height()-this.drop)/2+this.drop)/r.container.height(),r.moveTo(t.x,t.y,e,600,"easeInOutCubic",i)},this.hide=function(){var t=this;this.location=null,this.el.stop().fadeOut(300,function(){t.desc&&t.desc.empty()})}}function e(){this.el=null,this.init=function(){this.el=$("<div></div>").addClass("mapplic-lightbox mfp-hide"),this.title=$("<h2></h2>").addClass("mapplic-lightbox-title").appendTo(this.el),this.desc=$("<div></div>").addClass("mapplic-lightbox-description").appendTo(this.el),this.link=$("<a>More</a>").addClass("mapplic-popup-link").attr("href","#").hide().appendTo(this.el),$("body").magnificPopup({delegate:".mapplic-popup-image",type:"image",removalDelay:300,mainClass:"mfp-fade"}),r.el.append(this.el)},this.show=function(t){this.location=t,this.title.text(t.title),this.desc.html(t.description),t.link?this.link.attr("href",t.link).show():this.link.hide(),$.magnificPopup.open({items:{src:this.el},type:"inline",removalDelay:300,mainClass:"mfp-fade",callbacks:{beforeClose:function(){r.deeplinking&&r.deeplinking.clear()}}});var i="undefined"!=typeof t.zoom?t.zoom:4;r.moveTo(t.x,t.y,i,600,"easeInOutCubic"),r.tooltip&&r.tooltip.hide()},this.hide=function(){$.magnificPopup.close(),this.location=null,r.deeplinking&&r.deeplinking.clear()}}function a(){this.el=null,this.pin=null,this.shift=6,this.init=function(){var t=this;this.el=$("<div></div>").addClass("mapplic-tooltip mapplic-hovertip"),this.title=$("<h4></h4>").addClass("mapplic-tooltip-title").appendTo(this.el),r.o.hovertip.desc&&(this.desc=$("<div></div>").addClass("mapplic-tooltip-description").appendTo(this.el)),this.triangle=$("<div></div>").addClass("mapplic-tooltip-triangle").appendTo(this.el),$(r.map).on("mouseover",".mapplic-layer a",function(){var i="";$(this).hasClass("mapplic-pin")?(i=$(this).data("location"),t.pin=$('.mapplic-pin[data-location="'+i+'"]'),t.shift=Math.abs(parseFloat(t.pin.css("margin-top")))+20):(i=$(this).attr("xlink:href").slice(1),t.shift=20);var e=r.getLocationData(i);e&&t.show(e)}).on("mouseout",function(){t.hide()}),r.o.selector&&$(r.map).on("mouseover",r.o.selector,function(){var i=r.getLocationData($(this).attr("id"));t.shift=20,i&&t.show(i)}).on("mouseout",function(){t.hide()}),r.map.append(this.el)},this.show=function(t){r.tooltip.location!=t&&(this.title.text(t.title),r.o.hovertip.desc&&this.desc.html(t.description),this.position(t),this.el.stop().fadeIn(100))},this.position=function(t){var i=r.map.offset().left+r.map.width()*t.x-r.container.offset().left,e=r.map.offset().top+r.map.height()*t.y-r.container.offset().top,a=100*t.x,o=100*t.y,n=-this.el.outerHeight()-this.shift,l=0,s=.5;Math.abs(n)>e?(n=10,this.pin&&this.pin.length&&(n=this.pin.height()+parseFloat(this.pin.css("margin-top"))+20),this.el.addClass("mapplic-bottom")):this.el.removeClass("mapplic-bottom"),this.el.outerWidth()/2>i?s=.5-(this.el.outerWidth()/2-i)/this.el.outerWidth():r.container.width()-i-this.el.outerWidth()/2<0&&(s=.5+(i+this.el.outerWidth()/2-r.container.width())/this.el.outerWidth()),l=-this.el.outerWidth()*s,this.triangle.css("left",Math.max(10,Math.min(90,100*s))+"%"),this.el.css({left:a+"%",top:o+"%",marginTop:n,marginLeft:l})},this.hide=function(){this.el.stop().fadeOut(200)}}function o(){this.param="location",this.init=function(){var t=this;this.check(0),window.onpopstate=function(i){return i.state&&t.check(600),!1}},this.check=function(t){var i=this.getUrlParam(this.param);r.showLocation(i,t,!0)},this.getUrlParam=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)"),e=i.exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},this.update=function(t){var i=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+this.param+"="+t;window.history.pushState({path:i},"",i)},this.clear=function(){history.pushState("",document.title,window.location.pathname)}}function n(){this.param="location",this.init=function(){var t=this;this.check(0),$(window).on("hashchange",function(){t.check(600)})},this.check=function(t){var i=location.hash.slice(this.param.length+2);r.showLocation(i,t,!0)},this.update=function(t){window.location.hash=this.param+"-"+t},this.clear=function(){window.location.hash=this.param}}function l(){this.el=null,this.opacity=null,this.init=function(){this.el=$("<div></div>").addClass("mapplic-minimap").appendTo(r.container),this.el.click(function(t){t.preventDefault();var i=(t.pageX-$(this).offset().left)/$(this).width(),e=(t.pageY-$(this).offset().top)/$(this).height();r.moveTo(i,e,r.scale/r.fitscale,100)})},this.addLayer=function(t){var i=$("<div></div>").addClass("mapplic-minimap-layer").addClass(t.id).appendTo(this.el),e=this;$("<img>").attr("src",t.minimap).addClass("mapplic-minimap-background").appendTo(i),$("<div></div>").addClass("mapplic-minimap-overlay").appendTo(i),$("<img>").attr("src",t.minimap).addClass("mapplic-minimap-active").load(function(){e.update(),$(this).addClass("mapplic-clip-transition")}).appendTo(i)},this.show=function(t){$(".mapplic-minimap-layer",this.el).hide(),$(".mapplic-minimap-layer."+t,this.el).show()},this.update=function(t,i){var e=$(".mapplic-minimap-active",this.el);void 0===t&&(t=r.x),void 0===i&&(i=r.y);var a=Math.round(r.container.width()/r.contentWidth/r.scale*this.el.width()),o=Math.round(r.container.height()/r.contentHeight/r.scale*this.el.height()),n=Math.round(-i/r.contentHeight/r.scale*this.el.height()),l=Math.round(-t/r.contentWidth/r.scale*this.el.width()),s=l+a,c=n+o;e.each(function(){$(this)[0].style.clip="rect("+n+"px, "+s+"px, "+c+"px, "+l+"px)"});var p=this;this.el.show(),this.el.css("opacity",1),clearTimeout(this.opacity),this.opacity=setTimeout(function(){p.el.css("opacity",0),setTimeout(function(){p.el.hide()},600)},2e3)}}function s(){this.el=null,this.list=null,this.init=function(){var t=this;if(this.el=$("<div><h3>Key amenity</h3></div>").addClass("mapplic-sidebar").appendTo(r.el),r.o.search){var i=$("<form></form>").addClass("mapplic-search-form").submit(function(){return!1}).appendTo(this.el);r.clear=$("<button></button>").addClass("mapplic-search-clear").click(function(){e.val(""),e.keyup()}).appendTo(i);var e=$("<input>").attr({type:"text",spellcheck:"false",placeholder:"Search..."}).addClass("mapplic-search-input").keyup(function(){var i=$(this).val();t.search(i)}).prependTo(i)}var a=$("<div></div>").addClass("mapplic-list-container").appendTo(this.el);this.list=$("<ol></ol>").addClass("mapplic-list").appendTo(a),this.notfound=$("<p></p>").addClass("mapplic-not-found").text("Nothing found. Please try a different search.").appendTo(a),r.o.search||a.css("padding-top","0")},this.addCategories=function(t){var i=this.list;t&&$.each(t,function(t,e){var a=$("<li></li>").addClass("mapplic-list-category").attr("data-category",e.id),o=$("<ol></ol>").css("border-color",e.color).appendTo(a);"false"==e.show?o.hide():a.addClass("mapplic-opened");var n=$("<a></a>").attr("title",e.title).css("background-color",e.color).text(e.title).prependTo(a);e.icon&&$("<img>").attr("src",e.icon).addClass("mapplic-list-thumbnail").prependTo(n),$("<span></span>").text("0").addClass("mapplic-list-count").prependTo(n),i.append(a)})},this.addLocation=function(t){var i=$("<li></li>").addClass("mapplic-list-location").addClass("mapplic-list-shown").attr("data-location",t.id),e=$("<a></a>").attr("href","#").click(function(i){i.preventDefault(),r.showLocation(t.id,600),$(window).width()<668&&$("html, body").animate({scrollTop:r.container.offset().top},400)}).appendTo(i);t.thumbnail&&$("<img>").attr("src",t.thumbnail).addClass("mapplic-list-thumbnail").appendTo(e),$("<h4></h4>").text(t.title).appendTo(e),$("<span></span>").html(t.about).appendTo(e);var a=$('.mapplic-list-category[data-category="'+t.category+'"]');a.length?$("ol",a).append(i):this.list.append(i),$(".mapplic-list-count",a).text($(".mapplic-list-shown",a).length)},this.search=function(t){t?r.clear.fadeIn(100):r.clear.fadeOut(100),$(".mapplic-list li",r.el).each(function(){$(this).text().search(new RegExp(t,"i"))<0?($(this).removeClass("mapplic-list-shown"),$(this).slideUp(200)):($(this).addClass("mapplic-list-shown"),$(this).show())}),$(".mapplic-list > li",r.el).each(function(){var t=$(".mapplic-list-shown",this).length;$(".mapplic-list-count",this).text(t)}),$(".mapplic-list > li.mapplic-list-shown").length>0?this.notfound.fadeOut(200):this.notfound.fadeIn(200)}}function c(){this.el=null,this.init=function(){this.el=$("<div></div>").addClass("mapplic-coordinates").appendTo(r.container),this.el.append("x: "),$("<code></code>").addClass("mapplic-coordinates-x").appendTo(this.el),this.el.append(" y: "),$("<code></code>").addClass("mapplic-coordinates-y").appendTo(this.el),$(".mapplic-layer",r.map).on("mousemove",function(t){var i=(t.pageX-r.map.offset().left)/r.map.width(),e=(t.pageY-r.map.offset().top)/r.map.height();$(".mapplic-coordinates-x").text(parseFloat(i).toFixed(4)),$(".mapplic-coordinates-y").text(parseFloat(e).toFixed(4))})}}function p(){this.el=null,this.init=function(){this.el=$("<a></a>").attr("href","#").addClass("mapplic-clear-button").appendTo(r.container),this.el.on("click touchstart",function(t){t.preventDefault(),r.hideLocation(),r.moveTo(.5,.5,1,400,"easeInOutCubic")})}}function h(){this.el=null,this.init=function(){this.el=$("<div></div>").addClass("mapplic-zoom-buttons").appendTo(r.container),this.zoomin=$("<a></ha>").attr("href","#").addClass("mapplic-zoomin-button").appendTo(this.el),this.zoomin.on("click touchstart",function(t){t.preventDefault();var i=r.scale;r.scale=C(i+.8*i),r.x=b(r.x-(r.container.width()/2-r.x)*(r.scale/i-1)),r.y=x(r.y-(r.container.height()/2-r.y)*(r.scale/i-1)),y(r.x,r.y,r.scale,400,"easeInOutCubic")}),this.zoomout=$("<a></ha>").attr("href","#").addClass("mapplic-zoomout-button").appendTo(this.el),this.zoomout.on("click touchstart",function(t){t.preventDefault();var i=r.scale;r.scale=C(i-.4*i),r.x=b(r.x-(r.container.width()/2-r.x)*(r.scale/i-1)),r.y=x(r.y-(r.container.height()/2-r.y)*(r.scale/i-1)),y(r.x,r.y,r.scale,400,"easeInOutCubic")})},this.update=function(t){this.zoomin.removeClass("mapplic-disabled"),this.zoomout.removeClass("mapplic-disabled"),t==r.fitscale?this.zoomout.addClass("mapplic-disabled"):t==r.o.maxscale&&this.zoomin.addClass("mapplic-disabled")}}function d(){this.el=null,this.init=function(){var t=this;this.element=r.el[0],$("<a></a>").attr("href","#").attr("href","#").addClass("mapplic-fullscreen-button").click(function(i){i.preventDefault(),t.isFull()?t.exitFull():t.goFull()}).appendTo(r.container)},this.goFull=function(){this.element.requestFullscreen?this.element.requestFullscreen():this.element.mozRequestFullScreen?this.element.mozRequestFullScreen():this.element.webkitRequestFullscreen?this.element.webkitRequestFullscreen():this.element.msRequestFullscreen&&this.element.msRequestFullscreen()},this.exitFull=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},this.isFull=function(){return window.innerHeight==screen.height}}var r=this;r.el=t,r.o={source:"locations.json",selector:"[id^=landmark] > *",landmark:!1,mapfill:!1,height:420,markers:!0,minimap:!0,sidebar:!0,search:!0,deeplinking:!0,clearbutton:!0,zoombuttons:!0,action:"tooltip",lightbox:!1,hovertip:{desc:!1},tooltip:{thumb:!0,desc:!0,link:!0},smartip:!0,fullscreen:!0,developer:!1,mousewheel:!1,maxscale:4,skin:"",zoom:!0},r.init=function(t){return r.o=$.extend(r.o,t),r.x=0,r.y=0,r.scale=1,r.el.addClass("mapplic-element mapplic-loading").addClass(r.o.skin),isNaN(r.o.height)||r.el.height(r.o.height),r.o.landmark&&(r.o.sidebar=!1,r.o.zoombuttons=!1,r.o.deeplinking=!1),"string"==typeof r.o.source?$.getJSON(r.o.source,function(t){u(t),r.el.removeClass("mapplic-loading")}).fail(function(){console.error("Couldn't load map data. (Make sure to run the script through a web server and not just open the html file in a browser directly)"),r.el.removeClass("mapplic-loading").addClass("mapplic-error"),alert("Data file missing or invalid!\nMake sure to run the script through web server.")}):(u(r.o.source),r.el.removeClass("mapplic-loading")),r};var u=function(t){r.data=t;var u=null;r.container=$("<div></div>").addClass("mapplic-container").appendTo(r.el),r.map=$("<div></div>").addClass("mapplic-map").appendTo(r.container),r.o.zoom&&r.map.addClass("mapplic-zoomable"),r.levelselect=$("<select></select>").addClass("mapplic-levels-select"),r.contentWidth=parseFloat(t.mapwidth),r.contentHeight=parseFloat(t.mapheight),r.o.minimap&&(r.minimap=new l,r.minimap.init()),r.o.sidebar?(r.sidebar=new s,r.sidebar.init(),r.sidebar.addCategories(t.categories)):r.container.css("width","100%");var v=0;if(t.levels&&$.each(t.levels,function(t,i){var e=i.map,a=e.substr(e.lastIndexOf(".")+1).toLowerCase(),o=$("<div></div>").addClass("mapplic-layer").attr("data-floor",i.id).hide().appendTo(r.map);switch(a){case"jpg":case"jpeg":case"png":case"gif":$("<img>").attr("src",e).addClass("mapplic-map-image").appendTo(o);break;case"svg":$("<div></div>").addClass("mapplic-map-image").load(e,function(){$(r.o.selector,this).each(function(){var t=r.getLocationData($(this).attr("id"));t&&($(this).attr("class","mapplic-clickable"),t.el=$(this),t.fill&&($(this).css("fill",t.fill),$("path",this).css("fill",t.fill)),r.o.landmark===t.id&&$(this).attr("class","mapplic-active"))}),$(r.o.selector,this).on("click touchend",function(){r.dragging||r.showLocation($(this).attr("id"),600)}),$("svg a",this).each(function(){var t=r.getLocationData($(this).attr("xlink:href").substr(1));t&&($(this).attr("class","mapplic-clickable"),t.el=$(this))}),$("svg a",this).click(function(t){var i=$(this).attr("xlink:href").substr(1);r.showLocation(i,600),t.preventDefault()})}).appendTo(o);break;default:alert("File type "+a+" is not supported!")}r.minimap&&r.minimap.addLayer(i),r.levelselect.prepend($("<option></option>").attr("value",i.id).text(i.title)),u&&!i.show||(u=i.id),$.each(i.locations,function(t,i){if(i.lat){var e=f(i.lat,i.lng);i.x=e.x,i.y=e.y}var a=100*i.y,n=100*i.x;if("hidden"!=i.pin&&r.o.markers){var l=$("<a></a>").attr("href","#").addClass("mapplic-pin").css({top:a+"%",left:n+"%"}).appendTo(o);l.on("click touchend",function(t){t.preventDefault(),r.showLocation(i.id,600)}),i.label&&l.html(i.label),i.fill&&l.css("background-color",i.fill),l.attr("data-location",i.id),l.addClass(i.pin),i.el=l}r.sidebar&&r.sidebar.addLocation(i)}),v++}),r.tooltip=new i,r.tooltip.init(),r.o.lightbox&&(r.lightbox=new e,r.lightbox.init()),r.o.hovertip&&(r.hovertip=new a,r.hovertip.init()),r.o.developer&&(r.devtools=(new c).init()),r.o.clearbutton&&(r.clearbutton=(new p).init()),r.o.zoombuttons&&(r.zoombuttons=new h,r.zoombuttons.init(),r.o.clearbutton||r.zoombuttons.el.css("bottom","0")),r.o.fullscreen&&(r.fullscreen=(new d).init()),v>1){r.levels=$("<div></div>").addClass("mapplic-levels");var g=$('<a href="#"></a>').addClass("mapplic-levels-up").appendTo(r.levels);r.levelselect.appendTo(r.levels);var w=$('<a href="#"></a>').addClass("mapplic-levels-down").appendTo(r.levels);r.container.append(r.levels),r.levelselect.change(function(){var t=$(this).val();r.switchLevel(t)}),g.click(function(t){t.preventDefault(),$(this).hasClass("mapplic-disabled")||r.switchLevel("+")}),w.click(function(t){t.preventDefault(),$(this).hasClass("mapplic-disabled")||r.switchLevel("-")})}r.switchLevel(u),$(window).resize(function(){if($(window).width()<668){var t=Math.min(Math.max(r.container.width()*r.contentHeight/r.contentWidth,2*$(window).height()/3),$(window).height()-66);r.container.height(t)}else r.container.height("100%");var i=r.container.width()/r.contentWidth,e=r.container.height()/r.contentHeight;r.o.mapfill?i>e?r.fitscale=i:r.fitscale=e:e>i?r.fitscale=i:r.fitscale=e,r.scale=C(r.scale),r.x=b(r.x),r.y=x(r.y),y(r.x,r.y,r.scale,100)}).resize(),r.o.landmark?r.showLocation(r.o.landmark,0):$(window).width()<668?r.moveTo(.5,.5,3,0):r.moveTo(.5,.5,1,0),r.o.deeplinking&&(history.pushState?r.deeplinking=new o:r.deeplinking=new n,r.deeplinking.init()),r.el.trigger("mapready",location),r.o.zoom&&m()},m=function(){var t=r.map,i=$(".mapplic-map-image",r.map);if(document.ondragstart=function(){return!1},i.on("mousedown",function(i){r.dragging=!1,t.stop(),t.data("mouseX",i.pageX),t.data("mouseY",i.pageY),t.data("lastX",r.x),t.data("lastY",r.y),t.addClass("mapplic-dragging"),r.map.on("mousemove",function(i){r.dragging=!0;var e=i.pageX-t.data("mouseX")+r.x,a=i.pageY-t.data("mouseY")+r.y;e=b(e),a=x(a),y(e,a),t.data("lastX",e),t.data("lastY",a)}),$(document).on("mouseup",function(){r.x=t.data("lastX"),r.y=t.data("lastY"),r.map.off("mousemove"),$(document).off("mouseup"),t.removeClass("mapplic-dragging")})}),$(document).on("dblclick",".mapplic-map-image",function(t){t.preventDefault();var i=r.scale;r.scale=C(2*i),r.x=b(r.x-(t.pageX-r.container.offset().left-r.x)*(r.scale/i-1)),r.y=x(r.y-(t.pageY-r.container.offset().top-r.y)*(r.scale/i-1)),y(r.x,r.y,r.scale,400,"easeInOutCubic")}),r.o.mousewheel&&$(".mapplic-layer",r.el).bind("mousewheel DOMMouseScroll",function(t,i){var e=r.scale;r.scale=C(e+e*i/5),t.preventDefault(),r.x=b(r.x-(t.pageX-r.container.offset().left-r.x)*(r.scale/e-1)),r.y=x(r.y-(t.pageY-r.container.offset().top-r.y)*(r.scale/e-1)),y(r.x,r.y,r.scale,200,"easeOutCubic")}),!("ontouchstart"in window||"onmsgesturechange"in window))return!0;i.on("touchstart",function(e){r.dragging=!1;var a=e.originalEvent,o=t.position();t.data("touchY",a.changedTouches[0].pageY-o.top),t.data("touchX",a.changedTouches[0].pageX-o.left),i.on("touchmove",function(e){e.preventDefault(),r.dragging=!0;var a=e.originalEvent,o=a.touches.length;1==o?(r.x=b(a.changedTouches[0].pageX-t.data("touchX")),r.y=x(a.changedTouches[0].pageY-t.data("touchY")),y(r.x,r.y,r.scale,50)):i.off("touchmove")}),i.on("touchend",function(t){i.off("touchmove touchend")})});var e=new Hammer(r.map[0],{transform_always_block:!0,drag_block_horizontal:!0,drag_block_vertical:!0});e.get("pinch").set({enable:!0});var a=1,o;e.on("pinchstart",function(t){r.dragging=!1,a=r.scale/r.fitscale,o=a}),e.on("pinch",function(t){r.dragging=!0,1!=t.scale&&(a=Math.max(1,Math.min(o*t.scale,100)));var i=r.scale;r.scale=C(a*r.fitscale),r.x=b(r.x-(t.center.x-r.container.offset().left-r.x)*(r.scale/i-1)),r.y=x(r.y-(t.center.y-r.y)*(r.scale/i-1)),y(r.x,r.y,r.scale,100)})},f=function(t,i){var e=r.data.rightLng-r.data.leftLng,a=r.data.bottomLat*Math.PI/180,o=r.data.mapwidth/e*360/(2*Math.PI),n=o/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)));return t=t*Math.PI/180,{x:(i-r.data.leftLng)*(r.data.mapwidth/e)/r.data.mapwidth,y:(r.data.mapheight-(o/2*Math.log((1+Math.sin(t))/(1-Math.sin(t)))-n))/r.data.mapheight}},v=function(t,i){var e=t.attr("class");-1==e.indexOf(i)&&t.attr("class",e+" "+i)},g=function(t,i){var e=t.attr("class");e&&t.attr("class",e.replace(i,"").trim())},w=function(t,i){var e=t.attr("class");return e.indexOf(i)>-1},b=function(t){var i=r.container.width()-r.contentWidth*r.scale;return 0>i?t>0?t=0:i>t&&(t=i):t=i/2,t},x=function(t){var i=r.container.height()-r.contentHeight*r.scale;return 0>i?t>=0?t=0:i>t&&(t=i):t=i/2,t},C=function(t){return t<r.fitscale?t=r.fitscale:t>r.o.maxscale&&(t=r.o.maxscale),r.zoombuttons&&r.zoombuttons.update(t),t},y=function(t,i,e,a,o){void 0!==e?r.map.stop().animate({left:t,top:i,width:r.contentWidth*e,height:r.contentHeight*e},a,o,function(){r.tooltip&&r.tooltip.position()}):r.map.css({left:t,top:i}),r.tooltip&&r.tooltip.position(),r.minimap&&r.minimap.update(t,i),r.el.trigger("positionchanged",location)};r.switchLevel=function(t){switch(t){case"+":t=$("option:selected",r.levelselect).removeAttr("selected").prev().prop("selected","selected").val();break;case"-":t=$("option:selected",r.levelselect).removeAttr("selected").next().prop("selected","selected").val();break;default:$('option[value="'+t+'"]',r.levelselect).prop("selected","selected")}if(t){var i=$('.mapplic-layer[data-floor="'+t+'"]',r.el);if(!i.is(":visible")){r.tooltip&&r.tooltip.hide(),$(".mapplic-layer:visible",r.map).hide(),i.show(),r.minimap&&r.minimap.show(t);var e=r.levelselect.get(0).selectedIndex,a=$(".mapplic-levels-up",r.el),o=$(".mapplic-levels-down",r.el);a.removeClass("mapplic-disabled"),o.removeClass("mapplic-disabled"),0==e?a.addClass("mapplic-disabled"):e==r.levelselect.get(0).length-1&&o.addClass("mapplic-disabled"),r.el.trigger("levelswitched",location)}}},r.moveTo=function(t,i,e,a,o,n){a="undefined"!=typeof a?a:400,n="undefined"!=typeof n?n:.5,e="undefined"!=typeof e?e:r.scale/r.fitscale,r.scale=C(r.fitscale*e),r.x=b(.5*r.container.width()-r.scale*r.contentWidth*t),r.y=x(r.container.height()*n-r.scale*r.contentHeight*i),y(r.x,r.y,r.scale,a,o)},r.getLocationData=function(t){var i=null;return $.each(r.data.levels,function(e,a){$.each(a.locations,function(e,a){a.id==t&&(i=a)})}),i},r.showLocation=function(t,i,e){$.each(r.data.levels,function(i,a){return a.id==t?(r.switchLevel(a.id),!1):void $.each(a.locations,function(i,o){if(o.id==t){var n="undefined"!=typeof o.action?o.action:r.o.action;switch(n){case"open-link":return window.location.href=o.link,!1;case"open-link-new-tab":return window.open(o.link),!1;case"select":return o.el&&(w(o.el,"mapplic-active")?g(o.el,"mapplic-active"):v(o.el,"mapplic-active")),!1;case"none":var l="undefined"!=typeof o.zoom?o.zoom:4;r.moveTo(o.x,o.y,l,600,"easeInOutCubic");break;case"lightbox":r.switchLevel(a.id),r.lightbox.show(o);break;default:r.switchLevel(a.id),r.tooltip.show(o)}g($(".mapplic-active",r.el),"mapplic-active"),o.el&&v(o.el,"mapplic-active"),r.o.deeplinking&&!e&&r.deeplinking.update(t),r.el.trigger("locationopened",o)}})})},r.hideLocation=function(){g($(".mapplic-active",r.el),"mapplic-active"),r.deeplinking&&r.deeplinking.clear(),r.tooltip.hide(),r.el.trigger("locationclosed")},r.updateLocation=function(t){var i=r.getLocationData(t);if(i.id==t&&i.el.is("a")){var e=100*i.y,a=100*i.x;i.el.css({top:e+"%",left:a+"%"})}}};$.extend($.easing,{def:"easeOutQuad",swing:function(t,i,e,a,o){return jQuery.easing[jQuery.easing.def](t,i,e,a,o)},easeOutQuad:function(t,i,e,a,o){return-a*(i/=o)*(i-2)+e},easeOutCubic:function(t,i,e,a,o){return a*((i=i/o-1)*i*i+1)+e},easeInOutCubic:function(t,i,e,a,o){return(i/=o/2)<1?a/2*i*i*i+e:a/2*((i-=2)*i*i+2)+e}}),$.fn.mapplic=function(i){return this.each(function(){var e=$(this);if(!e.data("mapplic")){var a=new t(e).init(i);e.data("mapplic",a)}})}}(jQuery);